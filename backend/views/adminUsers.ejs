<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/css/adminDashboard.css">
    <link rel="stylesheet" href="/css/pagination.css">
    <link rel="stylesheet" href="/css/adminDepartments.css">
    <link rel="stylesheet" href="/css/adminUsers.css">

</head>

<body>
    <div class="dashboard-container">
        <header class="header">
            <h1>Admin Dashboard — <%= username %>
            </h1>
            <button id="logout-btn" class="logout-btn">Logout</button>
        </header>

        <main class="main">
            <aside class="navigation">
                <h3>Navigation</h3>
                <nav>
                    <a href="/admin/navigateDepartments">Departments</a>
                    <a href="/admin/navigateUsers">Users</a>
                    <a href="/admin/navigateAddUsers">Add User</a>
                </nav>
            </aside>

            <section class="overview">
                <!-- USERS TABLE -->
                <% if (users.length> 0) { %>
                    <table id="department-table" cellPadding="10">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Role</th>
                                <th>Department</th>
                                <th>Action</th>
                            </tr>
                        </thead>

                        <tbody id="department-body">
                            <% users.forEach(user=> { %>
                                <tr>
                                    <td>
                                        <%= user.name %>
                                    </td>
                                    <td>
                                        <%= user.email %>
                                    </td>
                                    <td>
                                        <%= user.phone %>
                                    </td>
                                    <td>
                                        <%= user.role %>
                                    </td>
                                    <td>
                                        <%= user.department?.name || "N/A" %>
                                    </td>
                                    <td>
                                        <button onclick="handleEdit('<%= JSON.stringify(user) %>')">Edit</button>
                                        <a href="/admin/users/deleteUser?id=<%= user._id %>">Delete</a>
                                    </td>
                                </tr>
                                <% }) %>
                        </tbody>
                    </table>

                    <!-- PAGINATION -->
                    <div class="pagination">
                        <a href="<%= currentPage > 1 ? '/admin/navigateUsers?page=' + (currentPage-1) : '#' %>"
                            class="page-btn <%= currentPage === 1 ? 'disabled' : '' %>">
                            Prev
                        </a>

                        <span class="page-info">
                            Page <%= currentPage %> of <%= totalPages %>
                        </span>

                        <a href="<%= currentPage < totalPages ? '/admin/navigateUsers?page=' + (currentPage+1) : '#' %>"
                            class="page-btn <%= currentPage === totalPages ? 'disabled' : '' %>">
                            Next
                        </a>
                    </div>

                    <% } else { %>
                        <div class="empty-msg">
                            No users found.
                        </div>
                        <% } %>
            </section>

            <!-- EDIT USER FORM (Hidden by default) -->
            <div id="editOverlay" class="edit-overlay hidden">
                <div class="edit-popup">

                    <div class="popup-header">
                        <h2>Edit User</h2>
                        <div class="close-btn" onclick="cancelEdit()">×</div>
                    </div>

                    <form action="/admin/users/update" method="POST" class="popup-form">
                        <input type="hidden" name="userId" id="editUserId">

                        <div class="row">
                            <div class="form-group">
                                <label>Name:</label>
                                <input type="text" name="name" id="editName" required>
                            </div>

                            <div class="form-group">
                                <label>Email:</label>
                                <input type="email" name="email" id="editEmail" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group">
                                <label>Phone:</label>
                                <input type="number" name="phone" id="editPhone" required>
                            </div>

                            <div class="form-group">
                                <label>Department:</label>
                                <select name="department" id="editDepartment">
                                    <% departments.forEach(d=> { %>
                                        <option value="<%= d._id %>">
                                            <%= d.name %>
                                        </option>
                                        <% }) %>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group">
                                <label>Role:</label>
                                <select name="role" id="editRole" disabled>
                                    <option value="Student">Student</option>
                                    <option value="Professor">Professor</option>
                                    <option value="HOD">HOD</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="submit-btn">Update User</button>
                    </form>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>© 2025 Admin Dashboard. All rights reserved.</p>
        </footer>
    </div>

    <script src="/script/adminUsers.js"></script>
</body>
<script src="/script/logout.js"></script>

</html>